var AudioletBuffer=function(a,c){this.numberOfChannels=a;this.length=c;this.channels=[];for(var b=0;b<this.numberOfChannels;b++){this.channels.push(new Float32Array(c))}this.unslicedChannels=[];for(var b=0;b<this.numberOfChannels;b++){this.unslicedChannels.push(this.channels[b])}this.isEmpty=false;this.channelOffset=0};AudioletBuffer.prototype.getChannelData=function(a){return(this.channels[a])};AudioletBuffer.prototype.set=function(a){var b=a.numberOfChannels;for(var c=0;c<b;c++){this.channels[c].set(a.getChannelData(c))}};AudioletBuffer.prototype.setSection=function(c,g,f,b){f=f||0;b=b||0;var d=c.numberOfChannels;for(var e=0;e<d;e++){f+=c.channelOffset;b+=this.channelOffset;var a=this.unslicedChannels[e].subarray(b,b+g);var h=c.unslicedChannels[e].subarray(f,f+g);
/*!
           var channel1 = this.getChannelData(i).subarray(outputOffset,
           outputOffset +
           length);
           var channel2 = buffer.getChannelData(i).subarray(inputOffset,
           inputOffset +
           length);
         */
a.set(h)}};AudioletBuffer.prototype.add=function(b){var f=this.length;var d=b.numberOfChannels;for(var e=0;e<d;e++){var a=this.getChannelData(e);var g=b.getChannelData(e);for(var c=0;c<f;c++){a[c]+=g[c]}}};AudioletBuffer.prototype.addSection=function(f,b,h,a){h=h||0;a=a||0;var k=f.numberOfChannels;for(var g=0;g<k;g++){var d=this.getChannelData(g);var c=f.getChannelData(g);for(var e=0;e<b;e++){d[e+a]+=c[e+h]}}};AudioletBuffer.prototype.resize=function(n,c,e,g){g=g||0;var j=this.channels;var b=this.unslicedChannels;var d=this.length;var f=this.channelOffset+g;for(var h=0;h<n;h++){var k=j[h];var m=b[h];if(c>d){var l=k;if(!e||!m||m.length<c){m=new Float32Array(c)}k=m.subarray(0,c);if(!e&&l){k.set(l,g)}f=0}else{if(!m){var a=b[0].length;m=new Float32Array(a)}g=f;k=m.subarray(g,g+c)}j[h]=k;b[h]=m}this.channels=j.slice(0,n);this.unslicedChannels=b.slice(0,n);this.length=c;this.numberOfChannels=n;this.channelOffset=f};AudioletBuffer.prototype.push=function(a){var b=a.length;this.resize(this.numberOfChannels,this.length+b);this.setSection(a,b,0,this.length-b)};AudioletBuffer.prototype.pop=function(a){var b=a.length;var c=this.length-b;a.setSection(this,b,c,0);this.resize(this.numberOfChannels,c)};AudioletBuffer.prototype.unshift=function(a){var b=a.length;this.resize(this.numberOfChannels,this.length+b,false,b);this.setSection(a,b,0,0)};AudioletBuffer.prototype.shift=function(a){var b=a.length;a.setSection(this,b,0,0);this.resize(this.numberOfChannels,this.length-b,false,b)};AudioletBuffer.prototype.zero=function(){var b=this.numberOfChannels;for(var c=0;c<b;c++){var e=this.getChannelData(c);var d=this.length;for(var a=0;a<d;a++){e[a]=0}}};AudioletBuffer.prototype.combined=function(){var a=this.channels;var b=this.numberOfChannels;var e=this.length;var d=new Float32Array(b*e);for(var c=0;c<b;c++){d.set(a[c],c*e)}return d};AudioletBuffer.prototype.interleaved=function(){var a=this.channels;var c=this.numberOfChannels;var e=this.length;var f=new Float32Array(c*e);for(var d=0;d<e;d++){for(var b=0;b<c;b++){f[c*d+b]=a[b][d]}}return f};AudioletBuffer.prototype.copy=function(){var a=new AudioletBuffer(this.numberOfChannels,this.length);a.set(this);return a};AudioletBuffer.prototype.load=function(c,a,d){var b=new AudioFileRequest(c,a);b.onSuccess=function(e){this.length=e.length;this.numberOfChannels=e.channels.length;this.unslicedChannels=e.channels;this.channels=e.channels;this.channelOffset=0;if(d){d()}}.bind(this);b.onFailure=function(){console.error("Could not load",c)}.bind(this);b.send()};var AudioletGroup=function(b,a,d){this.audiolet=b;this.numberOfInputs=a;this.numberOfOutputs=d;this.inputs=[];for(var c=0;c<a;c++){this.inputs.push(new PassThroughNode(this.audiolet,1,1))}this.outputs=[];for(var c=0;c<d;c++){this.outputs.push(new PassThroughNode(this.audiolet,1,1))}};AudioletGroup.prototype.connect=function(c,b,a){this.outputs[b||0].connect(c,0,a)};AudioletGroup.prototype.disconnect=function(c,b,a){this.outputs[b||0].disconnect(c,0,a)};AudioletGroup.prototype.remove=function(){var a=this.inputs.length;for(var b=0;b<a;b++){this.inputs[b].remove()}var c=this.outputs.length;for(var b=0;b<c;b++){this.outputs[b].remove()}};
/*!
 * @depends AudioletGroup.js
 */
var AudioletDestination=function(c,b,a,d){AudioletGroup.call(this,c,1,0);this.device=new AudioletDevice(c,b,a,d);c.device=this.device;this.scheduler=new Scheduler(c);c.scheduler=this.scheduler;this.blockSizeLimiter=new BlockSizeLimiter(c,Math.pow(2,15));c.blockSizeLimiter=this.blockSizeLimiter;this.upMixer=new UpMixer(c,this.device.numberOfChannels);this.inputs[0].connect(this.blockSizeLimiter);this.blockSizeLimiter.connect(this.scheduler);this.scheduler.connect(this.upMixer);this.upMixer.connect(this.device)};extend(AudioletDestination,AudioletGroup);AudioletDestination.prototype.toString=function(){return"Destination"};var AudioletNode=function(c,b,e,a){this.audiolet=c;this.numberOfInputs=b;this.numberOfOutputs=e;this.inputs=[];var b=this.numberOfInputs;for(var d=0;d<b;d++){this.inputs.push(new AudioletInput(this,d))}this.outputs=[];var e=this.numberOfOutputs;for(var d=0;d<e;d++){this.outputs.push(new AudioletOutput(this,d))}if(a){this.generate=a}this.timestamp=null};AudioletNode.prototype.connect=function(d,c,b){if(d instanceof AudioletGroup){d=d.inputs[b||0];b=0}var a=this.outputs[c||0];var e=d.inputs[b||0];a.connect(e);e.connect(a)};AudioletNode.prototype.disconnect=function(d,c,b){if(d instanceof AudioletGroup){d=d.inputs[b||0];b=0}var a=this.outputs[c||0];var e=d.inputs[b||0];e.disconnect(a);a.disconnect(e)};AudioletNode.prototype.setNumberOfOutputChannels=function(a,b){this.outputs[a].numberOfChannels=b};AudioletNode.prototype.linkNumberOfOutputChannels=function(b,a){this.outputs[b].linkNumberOfChannels(this.inputs[a])};AudioletNode.prototype.tick=function(b,c){if(c!=this.timestamp){this.timestamp=c;this.tickParents(b,c);var a=this.createInputBuffers(b);var d=this.createOutputBuffers(b);this.generate(a,d)}};AudioletNode.prototype.tickParents=function(g,h){var a=this.numberOfInputs;for(var e=0;e<a;e++){var b=this.inputs[e];var f=b.connectedFrom.length;for(var d=0;d<f;d++){var c=f-d-1;b.connectedFrom[c].node.tick(g,h)}}};AudioletNode.prototype.generate=function(c,e){var a=c.length;var d=e.length;for(var b=0;b<a;b++){if(b<d&&c[b].isEmpty){e[b].isEmpty=true}}};AudioletNode.prototype.createInputBuffers=function(b){var f=[];var h=this.numberOfInputs;for(var e=0;e<h;e++){var o=this.inputs[e];var n=0;var g=null;var m=o.connectedFrom;var l=m.length;for(var d=0;d<l;d++){var c=m[d];var a=c.buffer;if(a.numberOfChannels>n&&!a.isEmpty){n=a.numberOfChannels;g=c}}if(g){var k=o.buffer;k.resize(n,b,true);k.isEmpty=false;k.set(g.getBuffer(b));for(var d=0;d<l;d++){var c=m[d];if(c!=g&&!c.buffer.isEmpty){k.add(c.getBuffer(b))}}f.push(k)}else{var k=o.buffer;k.resize(1,b,true);k.isEmpty=true;f.push(k)}}return f};AudioletNode.prototype.createOutputBuffers=function(c){var e=[];var d=this.numberOfOutputs;for(var b=0;b<d;b++){var a=this.outputs[b];a.buffer.resize(a.getNumberOfChannels(),c,true);a.buffer.isEmpty=false;e.push(a.buffer)}return(e)};AudioletNode.prototype.remove=function(){var g=this.inputs.length;for(var e=0;e<g;e++){var h=this.inputs[e];var c=h.connectedFrom.length;for(var d=0;d<c;d++){var a=h.connectedFrom[d];var b=a.node;b.disconnect(this,a.index,e)}}var f=this.outputs.length;for(var e=0;e<f;e++){var b=this.outputs[e];var c=b.connectedTo.length;for(var d=0;d<c;d++){var k=b.connectedTo[d];var h=k.node;this.disconnect(h,e,k.index)}}};
/*!
 * @depends AudioletNode.js
 */
function AudioletDevice(c,b,a,d){AudioletNode.call(this,c,1,0);this.sink=Sink(this.tick.bind(this),a,d,b);this.sampleRate=this.sink.sampleRate;this.numberOfChannels=this.sink.channelCount;this.bufferSize=this.sink.preBufferSize;this.writePosition=0;this.buffer=null;this.paused=false}extend(AudioletDevice,AudioletNode);AudioletDevice.prototype.tick=function(b,c){if(!this.paused){var e=b.length/c;AudioletNode.prototype.tick.call(this,e,this.writePosition);var f=this.buffer.interleaved();var a=f.length;for(var d=0;d<a;d++){b[d]=f[d]}this.writePosition+=e}};AudioletDevice.prototype.generate=function(a,b){this.buffer=a[0]};AudioletDevice.prototype.getPlaybackTime=function(){return this.sink.getPlaybackTime()};AudioletDevice.prototype.getWriteTime=function(){return this.writePosition};AudioletDevice.prototype.pause=function(){this.paused=true};AudioletDevice.prototype.play=function(){this.paused=false};AudioletDevice.prototype.toString=function(){return"Audio Output Device"};var AudioletInput=function(b,a){this.node=b;this.index=a;this.connectedFrom=[];this.buffer=new AudioletBuffer(1,0);this.overflow=new AudioletBuffer(1,0)};AudioletInput.prototype.connect=function(a){this.connectedFrom.push(a)};AudioletInput.prototype.disconnect=function(a){var c=this.connectedFrom.length;for(var b=0;b<c;b++){if(a==this.connectedFrom[b]){this.connectedFrom.splice(b,1);break}}};AudioletInput.prototype.isConnected=function(){return(this.connectedFrom.length>0)};AudioletInput.prototype.toString=function(){return this.node.toString()+"Input #"+this.index};var Audiolet=function(b,a,c){this.output=new AudioletDestination(this,b,a,c)};var AudioletOutput=function(b,a){this.node=b;this.index=a;this.connectedTo=[];this.buffer=new AudioletBuffer(1,0);this.feedbackBuffer=new AudioletBuffer(1,0);this.outputBuffer=new AudioletBuffer(1,0);this.linkedInput=null;this.numberOfChannels=1;this.suppliesFeedbackLoop=false;this.timestamp=null};AudioletOutput.prototype.connect=function(a){this.connectedTo.push(a)};AudioletOutput.prototype.disconnect=function(a){var c=this.connectedTo.length;for(var b=0;b<c;b++){if(a==this.connectedTo[b]){this.connectedTo.splice(b,1);break}}};AudioletOutput.prototype.isConnected=function(){return(this.connectedTo.length>0)};AudioletOutput.prototype.linkNumberOfChannels=function(a){this.linkedInput=a};AudioletOutput.prototype.unlinkNumberOfChannels=function(){this.linkedInput=null};AudioletOutput.prototype.getNumberOfChannels=function(){if(this.linkedInput&&this.linkedInput.isConnected()){return(this.linkedInput.buffer.numberOfChannels)}return(this.numberOfChannels)};AudioletOutput.prototype.getBuffer=function(d){var b=this.buffer;if(b.length==d&&!this.suppliesFeedbackLoop){return b}else{if(this.node.timestamp==this.timestamp){return this.outputBuffer}else{this.timestamp=this.node.timestamp;var e=this.feedbackBuffer;var c=this.outputBuffer;if(!this.suppliesFeedbackLoop){this.suppliesFeedbackLoop=true;var a=this.node.audiolet.blockSizeLimiter;e.resize(this.getNumberOfChannels(),a.maximumBlockSize,true)}e.resize(this.getNumberOfChannels(),e.length);c.resize(this.getNumberOfChannels(),d,true);e.push(b);e.shift(c);return c}}};AudioletOutput.prototype.toString=function(){return this.node.toString()+"Output #"+this.index+" - "};var AudioletParameter=function(a,c,b){this.node=a;if(typeof c!="undefined"&&c!=null){this.input=a.inputs[c]}else{this.input=null}this.value=b||0};AudioletParameter.prototype.isStatic=function(){var a=this.input;return(a==null||a.connectedFrom.length==0||a.buffer.isEmpty)};AudioletParameter.prototype.isDynamic=function(){var a=this.input;return(a!=null&&a.connectedFrom.length>0&&!a.buffer.isEmpty)};AudioletParameter.prototype.setValue=function(a){this.value=a};AudioletParameter.prototype.getValue=function(){return this.value};AudioletParameter.prototype.getChannel=function(){return this.input.buffer.channels[0]};
/*!
 * @depends AudioletNode.js
 */
var BlockSizeLimiter=function(a,b){AudioletNode.call(this,a,1,1);this.maximumBlockSize=b;this.linkNumberOfOutputChannels(0,0)};extend(BlockSizeLimiter,AudioletNode);BlockSizeLimiter.prototype.tick=function(e,f){var c=this.maximumBlockSize;if(e<c){AudioletNode.prototype.tick.call(this,e,f)}else{var b=0;var h=null;while(b<e){var g;var a=e%c;if(b==0&&a){g=a}else{g=c}this.tickParents(g,f+b);var d=this.createInputBuffers(g);if(!h){h=this.createOutputBuffers(e)}this.generate(d,h,b);b+=g}}};BlockSizeLimiter.prototype.generate=function(b,d,e){e=e||0;var c=b[0];var a=d[0];if(c.isEmpty){a.isEmpty=true;return}a.setSection(c,c.length,0,e)};BlockSizeLimiter.prototype.toString=function(){return"Block Size Limiter"};function extend(a,c){function b(){}b.prototype=c.prototype;a.prototype=new b();a.prototype.constructor=a}
/*!
 * @depends ../core/AudioletNode.js
 */
var ParameterNode=function(a,b){AudioletNode.call(this,a,1,1);this.parameter=new AudioletParameter(this,0,b)};extend(ParameterNode,AudioletNode);ParameterNode.prototype.generate=function(e,h){var b=h[0];var c=b.channels[0];var f=this.parameter;var j,g;if(f.isStatic()){j=f.getValue()}else{g=f.getChannel()}var a=b.length;for(var d=0;d<a;d++){if(g){j=g[d]}c[d]=j}};ParameterNode.prototype.toString=function(){return"Parameter Node"};
/*!
 * @depends AudioletNode.js
 */
var PassThroughNode=function(b,a,c){AudioletNode.call(this,b,a,c)};extend(PassThroughNode,AudioletNode);PassThroughNode.prototype.createOutputBuffers=function(e){var g=[];var f=this.numberOfOutputs;var a=this.numberOfInputs;for(var d=0;d<f;d++){var c=this.outputs[d];if(d<a){var b=this.inputs[d];c.buffer=b.buffer}else{c.buffer.resize(c.getNumberOfChannels(),e)}g.push(c.buffer)}return(g)};PassThroughNode.prototype.toString=function(){return"Pass Through Node"};var PriorityQueue=function(c,b){if(b){this.compare=b}if(c){this.heap=c;for(var a=0;a<Math.floor(this.heap.length/2);a++){this.siftUp(a)}}else{this.heap=[]}};PriorityQueue.prototype.push=function(a){this.heap.push(a);this.siftDown(0,this.heap.length-1)};PriorityQueue.prototype.pop=function(){var b,a;b=this.heap.pop();if(this.heap.length){var a=this.heap[0];this.heap[0]=b;this.siftUp(0)}else{a=b}return(a)};PriorityQueue.prototype.peek=function(){return(this.heap[0])};PriorityQueue.prototype.isEmpty=function(){return(this.heap.length==0)};PriorityQueue.prototype.siftDown=function(d,a){var b=this.heap[a];while(a>d){var e=(a-1)>>1;var c=this.heap[e];if(this.compare(b,c)){this.heap[a]=c;a=e;continue}break}this.heap[a]=b};PriorityQueue.prototype.siftUp=function(a){var e=this.heap.length;var d=a;var c=this.heap[a];var b=2*a+1;while(b<e){var f=b+1;if(f<e&&!this.compare(this.heap[b],this.heap[f])){b=f}this.heap[a]=this.heap[b];a=b;b=2*a+1}this.heap[a]=c;this.siftDown(d,a)};PriorityQueue.prototype.compare=function(d,c){return(d<c)};
/*!
 * @depends AudioletNode.js
 */
var Scheduler=function(a,b){AudioletNode.call(this,a,1,1);this.linkNumberOfOutputChannels(0,0);this.bpm=b||120;this.queue=new PriorityQueue(null,function(d,c){return(d.time<c.time)});this.time=0;this.beat=0;this.beatInBar=0;this.bar=0;this.seconds=0;this.beatsPerBar=0;this.lastBeatTime=0;this.beatLength=60/this.bpm*this.audiolet.device.sampleRate;this.emptyBuffer=new AudioletBuffer(1,1)};extend(Scheduler,AudioletNode);Scheduler.prototype.setTempo=function(a){this.bpm=a;this.beatLength=60/this.bpm*this.audiolet.device.sampleRate};Scheduler.prototype.addRelative=function(a,c){var b={};b.callback=c;b.time=this.time+a*this.beatLength;this.queue.push(b);return b};Scheduler.prototype.addAbsolute=function(b,c){if(b<this.beat||b==this.beat&&this.time>this.lastBeatTime){return null}var a={};a.callback=c;a.time=this.lastBeatTime+(b-this.beat)*this.beatLength;this.queue.push(a);return a};Scheduler.prototype.play=function(b,a,d){var c={};c.patterns=b;c.durationPattern=a;c.callback=d;c.time=this.audiolet.device.getWriteTime();this.queue.push(c);return c};Scheduler.prototype.playAbsolute=function(d,b,a,e){if(d<this.beat||d==this.beat&&this.time>this.lastBeatTime){return null}var c={};c.patterns=b;c.durationPattern=a;c.callback=e;c.time=this.lastBeatTime+(d-this.beat)*this.beatLength;this.queue.push(c);return c};Scheduler.prototype.remove=function(b){var a=this.queue.heap.indexOf(b);if(a!=-1){this.queue.heap.splice(a,1);this.queue=new PriorityQueue(this.queue.heap,function(d,c){return(d.time<c.time)})}};Scheduler.prototype.stop=function(a){this.remove(a)};Scheduler.prototype.tick=function(c,j){var d=this.audiolet.device.getWriteTime();this.updateClock(d);var l=null;var a=d;while(!this.queue.isEmpty()&&this.queue.peek().time<=d+c){var b=this.queue.pop();var k=Math.floor(Math.max(b.time,a));var e=k-a;if(e>0){var g=a-d;this.tickParents(e,j+g);var h=this.createInputBuffers(e);if(!l){var l=this.createOutputBuffers(c)}this.generate(h,l,g)}this.updateClock(k);a=k;this.processEvent(b)}var f=d+c-a;if(f){this.tickParents(f,j+a-d);var h=this.createInputBuffers(f);if(!l){var l=this.createOutputBuffers(c)}var g=a-d;this.generate(h,l,g)}};Scheduler.prototype.updateClock=function(a){this.time=a;this.seconds=this.time/this.audiolet.device.sampleRate;if(this.time>=this.lastBeatTime+this.beatLength){this.beat+=1;this.beatInBar+=1;if(this.beatInBar==this.beatsPerBar){this.bar+=1;this.beatInBar=0}this.lastBeatTime+=this.beatLength}};Scheduler.prototype.processEvent=function(a){var h=a.durationPattern;if(h){var g=[];var b=a.patterns;var e=b.length;for(var d=0;d<e;d++){var f=b[d];var j=f.next();if(j!=null){g.push(j)}else{return}}a.callback.apply(null,g);var c;if(h instanceof Pattern){c=h.next()}else{c=h}if(c){a.time+=c*this.beatLength;this.queue.push(a)}}else{a.callback()}};Scheduler.prototype.generate=function(g,j,e){var h=g[0];var b=j[0];for(var f=0;f<h.numberOfChannels;f++){var a;if(h.isEmpty){var c=this.emptyBuffer;c.resize(h.numberOfChannels,h.length);a=c.getChannelData(0)}else{a=h.getChannelData(f)}var d=b.getChannelData(f);d.set(a,e)}};Scheduler.prototype.toString=function(){return"Scheduler"};var Int8Array,Uint8Array,Int16Array,Uint16Array;var Int32Array,Uint32Array,Float32Array,Float64Array;var types=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];var original,shim;for(var i=0;i<types.length;++i){if(types[i]){if(types[i].prototype.slice===undefined){original="subarray";shim="slice"}else{if(types[i].prototype.subarray===undefined){original="slice";shim="subarray"}}Object.defineProperty(types[i].prototype,shim,{value:types[i].prototype[original],enumerable:false})}}
/*!
 * @depends ../core/AudioletNode.js
 */
var Add=function(a,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.value=new AudioletParameter(this,1,b||0)};extend(Add,AudioletNode);Add.prototype.generate=function(h,m){var k=h[0];var d=m[0];if(k.isEmpty){d.isEmpty=true;return}var l=this.value;var o,c;if(l.isStatic()){o=l.getValue()}else{c=l.getChannel()}var n=k.numberOfChannels;for(var g=0;g<n;g++){var b=k.getChannelData(g);var f=d.getChannelData(g);var a=k.length;for(var e=0;e<a;e++){if(c){o=c[e]}f[e]=b[e]+o}}};Add.prototype.toString=function(){return"Add"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Divide=function(a,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.value=new AudioletParameter(this,1,b||1)};extend(Divide,AudioletNode);Divide.prototype.generate=function(h,m){var k=h[0];var d=m[0];if(k.isEmpty){d.isEmpty=true;return}var l=this.value;var o,c;if(l.isStatic()){o=l.getValue()}else{c=l.getChannel()}var n=k.numberOfChannels;for(var g=0;g<n;g++){var b=k.getChannelData(g);var f=d.getChannelData(g);var a=k.length;for(var e=0;e<a;e++){if(c){o=c[e]}f[e]=b[e]/o}}};Divide.prototype.toString=function(){return"Divide"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Modulo=function(a,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.value=new AudioletParameter(this,1,b||1)};extend(Modulo,AudioletNode);Modulo.prototype.generate=function(h,m){var k=h[0];var d=m[0];if(k.isEmpty){d.isEmpty=true;return}var l=this.value;var o,c;if(l.isStatic()){o=l.getValue()}else{c=l.getChannel()}var n=k.numberOfChannels;for(var g=0;g<n;g++){var b=k.getChannelData(g);var f=d.getChannelData(g);var a=k.length;for(var e=0;e<a;e++){if(c){o=c[e]}f[e]=b[e]%o}}};Modulo.prototype.toString=function(){return"Modulo"};
/*!
 * @depends ../core/AudioletNode.js
 */
var MulAdd=function(a,c,b){AudioletNode.call(this,a,3,1);this.linkNumberOfOutputChannels(0,0);this.mul=new AudioletParameter(this,1,c||1);this.add=new AudioletParameter(this,2,b||0)};extend(MulAdd,AudioletNode);MulAdd.prototype.generate=function(m,q){var n=m[0];var c=q[0];if(n.isEmpty){c.isEmpty=true;return}var f=this.mul;var e,d;if(f.isStatic()){e=f.getValue()}else{d=f.getChannel()}var p=this.add;var r,l;if(p.isStatic()){r=p.getValue()}else{l=p.getChannel()}var o=n.numberOfChannels;for(var k=0;k<o;k++){var b=n.getChannelData(k);var h=c.getChannelData(k);var a=n.length;for(var g=0;g<a;g++){if(d){e=d[g]}if(l){r=l[g]}h[g]=b[g]*e+r}}};MulAdd.prototype.toString=function(){return"Multiplier/Adder"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Multiply=function(a,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.value=new AudioletParameter(this,1,b||1)};extend(Multiply,AudioletNode);Multiply.prototype.generate=function(h,m){var k=h[0];var d=m[0];if(k.isEmpty){d.isEmpty=true;return}var l=this.value;var o,c;if(l.isStatic()){o=l.getValue()}else{c=l.getChannel()}var n=k.numberOfChannels;for(var g=0;g<n;g++){var b=k.getChannelData(g);var f=d.getChannelData(g);var a=k.length;for(var e=0;e<a;e++){if(c){o=c[e]}f[e]=b[e]*o}}};Multiply.prototype.toString=function(){return"Multiply"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Reciprocal=function(a){AudioletNode.call(this,a,1,1);this.linkNumberOfOutputChannels(0,0)};extend(Reciprocal,AudioletNode);Reciprocal.prototype.generate=function(g,k){var h=g[0];var c=k[0];if(h.isEmpty){c.isEmpty=true;return}var l=h.numberOfChannels;for(var f=0;f<l;f++){var b=h.getChannelData(f);var e=c.getChannelData(f);var a=h.length;for(var d=0;d<a;d++){e[d]=1/b[d]}}};Reciprocal.prototype.toString=function(){return"Reciprocal"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Subtract=function(a,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.value=new AudioletParameter(this,1,b||0)};extend(Subtract,AudioletNode);Subtract.prototype.generate=function(h,m){var k=h[0];var d=m[0];if(k.isEmpty){d.isEmpty=true;return}var l=this.value;var o,c;if(l.isStatic()){o=l.getValue()}else{c=l.getChannel()}var n=k.numberOfChannels;for(var g=0;g<n;g++){var b=k.getChannelData(g);var f=d.getChannelData(g);var a=k.length;for(var e=0;e<a;e++){if(c){o=c[e]}f[e]=b[e]-o}}};Subtract.prototype.toString=function(){return"Subtract"};var Tanh=function(a){AudioletNode.call(this,a,1,1);this.linkNumberOfOutputChannels(0,0)};extend(Tanh,AudioletNode);Tanh.prototype.generate=function(g,k){var h=g[0];var c=k[0];if(h.isEmpty){c.isEmpty=true;return}var l=h.numberOfChannels;for(var f=0;f<l;f++){var b=h.getChannelData(f);var e=c.getChannelData(f);var a=h.length;for(var d=0;d<a;d++){var m=b[d];e[d]=(Math.exp(m)-Math.exp(-m))/(Math.exp(m)+Math.exp(-m))}}};Tanh.prototype.toString=function(){return("Tanh")};
/*!
 * @depends ../core/AudioletNode.js
 */
var Envelope=function(b,c,d,f,a,e){AudioletNode.call(this,b,1,1);this.gate=new AudioletParameter(this,0,c||1);this.levels=d;this.times=f;this.releaseStage=a;this.onComplete=e;this.stage=null;this.time=null;this.changeTime=null;this.level=d[0];this.delta=0;this.gateOn=false};extend(Envelope,AudioletNode);Envelope.prototype.generate=function(h,p){var e=p[0];var m=e.getChannelData(0);var n=this.gate;var j,c;if(n.isStatic()){j=n.getValue()}else{c=n.getChannel()}var r=this.releaseStage;var l=this.stage;var d=this.time;var g=this.changeTime;var b=this.level;var q=this.delta;var k=this.gateOn;var o=false;var a=e.length;for(var f=0;f<a;f++){if(c){j=c[f]}if(j&&!k){k=true;l=0;d=0;q=0;b=this.levels[0];if(l!=r){o=true}}if(k&&!j){k=false;if(r!=null){l=r;o=true}}if(g){d+=1;if(d>=g){l+=1;if(l!=r){o=true}else{g=null;q=0}}}if(o){if(l!=this.times.length){q=this.calculateDelta(l,b);g=this.calculateChangeTime(l,d)}else{if(this.onComplete){this.onComplete()}l=null;d=null;g=null;q=0}o=false}b+=q;m[f]=b}this.stage=l;this.time=d;this.changeTime=g;this.level=b;this.delta=q;this.gateOn=k};Envelope.prototype.calculateDelta=function(b,d){var c=this.levels[b+1]-d;var a=this.times[b]*this.audiolet.device.sampleRate;return(c/a)};Envelope.prototype.calculateChangeTime=function(b,c){var a=this.times[b]*this.audiolet.device.sampleRate;return(c+a)};Envelope.prototype.toString=function(){return"Envelope"};
/*!
 * @depends Envelope.js
 */
var ADSREnvelope=function(j,e,c,d,g,f,b){var h=[0,1,g,0];var a=[c,d,f];Envelope.call(this,j,e,h,a,2,b)};extend(ADSREnvelope,Envelope);ADSREnvelope.prototype.toString=function(){return"ADSR Envelope"};
/*!
 * @depends ../core/AudioletNode.js
 */
var BiquadFilter=function(a,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.frequency=new AudioletParameter(this,1,b||22100);this.lastFrequency=null;this.xValues=[];this.yValues=[];this.b0=0;this.b1=0;this.b2=0;this.a0=0;this.a1=0;this.a2=0};extend(BiquadFilter,AudioletNode);BiquadFilter.prototype.calculateCoefficients=function(a){};BiquadFilter.prototype.generate=function(c,q){var w=c[0];var E=q[0];if(w.isEmpty){E.isEmpty=true;return}var v=this.xValues;var A=this.yValues;var f=[];var s=[];var g=w.numberOfChannels;for(var y=0;y<g;y++){f.push(w.getChannelData(y));s.push(E.getChannelData(y));if(y>=v.length){v.push([0,0]);A.push([0,0])}}var p=this.frequency;var u,e;if(p.isStatic()){u=p.getValue()}else{e=p.getChannel()}var r=this.lastFrequency;var H=this.a0;var G=this.a1;var F=this.a2;var o=this.b0;var n=this.b1;var m=this.b2;var l=E.length;for(var y=0;y<l;y++){if(e){var u=e[y]}if(u!=r){this.calculateCoefficients(u);r=u;H=this.a0;G=this.a1;F=this.a2;o=this.b0;n=this.b1;m=this.b2}for(var x=0;x<g;x++){var k=f[x];var t=s[x];var C=v[x];var B=C[0];var z=C[1];var h=A[x];var b=h[0];var a=h[1];var D=k[y];var d=(o/H)*D+(n/H)*B+(m/H)*z-(G/H)*b-(F/H)*a;t[y]=d;C[0]=D;C[1]=B;h[0]=d;h[1]=b}}this.lastFrequency=r};BiquadFilter.prototype.toString=function(){return"Biquad Filter"};
/*!
 * @depends BiquadFilter.js
 */
var AllPassFilter=function(a,b){BiquadFilter.call(this,a,b)};extend(AllPassFilter,BiquadFilter);AllPassFilter.prototype.calculateCoefficients=function(e){var b=2*Math.PI*e/this.audiolet.device.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=1-d;this.b1=-2*a;this.b2=1+d;this.a0=1+d;this.a1=-2*a;this.a2=1-d};AllPassFilter.prototype.toString=function(){return"All Pass Filter"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Amplitude=function(c,d,a){AudioletNode.call(this,c,3,1);this.linkNumberOfOutputChannels(0,0);this.followers=[];var b=this.audiolet.device.sampleRate;this.attack=new AudioletParameter(this,1,d||0.01);this.release=new AudioletParameter(this,2,a||0.01)};extend(Amplitude,AudioletNode);Amplitude.prototype.generate=function(b,h){var p=b[0];var v=h[0];if(p.isEmpty){v.isEmpty=true;return}var d=this.followers;var e=d.length;var a=this.audiolet.device.sampleRate;var w=this.attack;var r,m;if(w.isStatic()){r=Math.pow(0.01,1/(w.getValue()*a))}else{m=w.getChannel()}var t=this.release;var u,n;if(t.isStatic()){u=Math.pow(0.01,1/(t.getValue()*a))}else{n=t.getChannel()}var c=p.numberOfChannels;for(var s=0;s<c;s++){if(s>=e){d.push(0)}var k=d[s];var f=p.getChannelData(s);var l=v.getChannelData(s);var g=p.length;for(var q=0;q<g;q++){var o=Math.abs(f[q]);if(m){r=Math.pow(0.01,1/(m[q]*a))}if(n){u=Math.pow(0.01,1/(n[q]*a))}if(o>k){k=r*(k-o)+o}else{k=u*(k-o)+o}l[q]=k}d[s]=k}};Amplitude.prototype.toString=function(){return("Amplitude")};
/*!
 * @depends ../core/PassThroughNode.js
 */
var BadValueDetector=function(a,b){PassThroughNode.call(this,a,1,1);this.linkNumberOfOutputChannels(0,0);if(b){this.callback=b}};extend(BadValueDetector,PassThroughNode);BadValueDetector.prototype.callback=function(c,b,a){console.error(c+" detected at channel "+b+" index "+a)};BadValueDetector.prototype.generate=function(d,g){var e=d[0];if(e.isEmpty){return}var h=e.numberOfChannels;for(var c=0;c<h;c++){var f=e.getChannelData(c);var a=e.length;for(var b=0;b<a;b++){var k=f[b];if(typeof k=="undefined"||k==null||isNaN(k)||k==Infinity||k==-Infinity){this.callback(k,c,b)}}}};BadValueDetector.prototype.toString=function(){return"Bad Value Detector"};
/*!
 * @depends BiquadFilter.js
 */
var BandPassFilter=function(a,b){BiquadFilter.call(this,a,b)};extend(BandPassFilter,BiquadFilter);BandPassFilter.prototype.calculateCoefficients=function(e){var b=2*Math.PI*e/this.audiolet.device.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=d;this.b1=0;this.b2=-d;this.a0=1+d;this.a1=-2*a;this.a2=1-d};BandPassFilter.prototype.toString=function(){return"Band Pass Filter"};
/*!
 * @depends BiquadFilter.js
 */
var BandRejectFilter=function(a,b){BiquadFilter.call(this,a,b)};extend(BandRejectFilter,BiquadFilter);BandRejectFilter.prototype.calculateCoefficients=function(e){var b=2*Math.PI*e/this.audiolet.device.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=1;this.b1=-2*a;this.b2=1;this.a0=1+d;this.a1=-2*a;this.a2=1-d};BandRejectFilter.prototype.toString=function(){return"Band Reject Filter"};
/*!
 * @depends ../core/AudioletNode.js
 */
var BitCrusher=function(a,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.bits=new AudioletParameter(this,1,b)};extend(BitCrusher,AudioletNode);BitCrusher.prototype.generate=function(k,n){var m=k[0];var c=n[0];if(m.isEmpty){c.isEmpty=true;return}var g=this.bits;var p,d;if(g.isStatic()){p=g.getValue()}else{d=g.getChannel()}var o=m.numberOfChannels;for(var h=0;h<o;h++){var b=m.getChannelData(h);var f=c.getChannelData(h);var a=m.length;for(var e=0;e<a;e++){if(d){p=d[e]}var l=Math.pow(2,p)-1;f[e]=Math.floor(b[e]*l)/l}}};BitCrusher.prototype.toString=function(){return"BitCrusher"};
/*!
 * @depends ../core/AudioletNode.js
 */
var BufferPlayer=function(c,b,e,d,a,f){AudioletNode.call(this,c,3,1);this.buffer=b;this.setNumberOfOutputChannels(0,this.buffer.numberOfChannels);this.position=d||0;this.playbackRate=new AudioletParameter(this,0,e||1);this.restartTrigger=new AudioletParameter(this,1,0);this.startPosition=new AudioletParameter(this,2,d||0);this.loop=new AudioletParameter(this,3,a||0);this.onComplete=f;this.restartTriggerOn=false;this.playing=true};extend(BufferPlayer,AudioletNode);BufferPlayer.prototype.generate=function(c,o){var x=o[0];var u=this.buffer;var A=this.position;var h=this.playing;var z=this.restartTriggerOn;var t=this.playbackRate;var m,r;if(t.isStatic()){m=t.getValue()}else{r=t.getChannel()}var n=this.restartTrigger;var d,b;if(n.isStatic()){d=n.getValue()}else{b=n.getChannel()}var g=this.startPosition;var p,s;if(g.isStatic()){p=g.getValue()}else{s=g.getChannel()}var e=this.loop;var y,a;if(e.isStatic()){y=e.getValue()}else{a=e.getChannel()}if(u.length==0||(!b&&!h)){x.isEmpty=true;return}var f=u.numberOfChannels;var l=x.length;for(var w=0;w<l;w++){if(r){m=r[w]}if(b){d=b[w]}if(a){y=a[w]}if(d>0&&!z){A=p;z=true;h=true}if(d<=0&&z){z=false}if(h){for(var v=0;v<f;v++){var k=u.channels[v];var q=x.channels[v];q[w]=k[Math.floor(A)]}A+=m;if(A>=u.length){if(y){A%=u.length}else{h=false;if(this.onComplete){this.onComplete()}}}}else{for(var v=0;v<f;v++){var q=x.channels[v];q[w]=0}}}this.playing=h;this.position=A;this.restartTriggerOn=z};BufferPlayer.prototype.toString=function(){return("Buffer player")};
/*!
 * @depends ../core/AudioletNode.js
 */
var CombFilter=function(a,d,c,b){AudioletNode.call(this,a,3,1);this.linkNumberOfOutputChannels(0,0);this.maximumDelayTime=d;this.delayTime=new AudioletParameter(this,1,c||1);this.decayTime=new AudioletParameter(this,2,b);var e=d*this.audiolet.device.sampleRate;this.buffers=[];this.readWriteIndex=0};extend(CombFilter,AudioletNode);CombFilter.prototype.generate=function(d,p){var s=d[0];var y=p[0];if(s.isEmpty){y.isEmpty=true;return}var w=this.maximumDelayTime;var c=this.audiolet.device.sampleRate;var C=this.delayTime;var a,x;if(C.isStatic()){a=Math.floor(C.getValue()*c)}else{x=C.getChannel()}var b=this.decayTime;var e,n;if(b.isStatic()){e=Math.floor(b.getValue()*c)}else{n=b.getChannel()}var f;if(C.isStatic()&&b.isStatic()){f=Math.exp(-3*a/e)}var A=this.buffers;var B=this.readWriteIndex;var h=s.channels;var q=y.channels;var g=s.numberOfChannels;var z=A.length;for(var v=z;v<g;v++){var l=w*c;A.push(new Float32Array(l))}var m=s.length;for(var v=0;v<m;v++){if(x){a=Math.floor(x[v]*c)}if(n){e=Math.floor(n[v]*c)}if(x||n){f=Math.exp(-3*a/e)}for(var u=0;u<g;u++){var k=h[u];var r=q[u];var t=A[u];var o=t[B];r[v]=o;t[B]=k[v]+f*o}B+=1;if(B>=a){B=0}}this.readWriteIndex=B};CombFilter.prototype.toString=function(){return"Comb Filter"};
/*!
 * @depends ../core/AudioletNode.js
 */
var TableLookupOscillator=function(a,b,c){AudioletNode.call(this,a,1,1);this.table=b;this.frequency=new AudioletParameter(this,0,c||440);this.phase=0};extend(TableLookupOscillator,AudioletNode);TableLookupOscillator.prototype.generate=function(f,l){var d=l[0];var h=d.getChannelData(0);var m=this.audiolet.device.sampleRate;var o=this.table;var k=o.length;var n=this.phase;var g=this.frequency;var j,c;if(g.isStatic()){j=g.getValue()}else{c=g.getChannel()}var a=d.length;for(var e=0;e<a;e++){if(c){j=c[e]}var b=j*k/m;n+=b;if(n>=k){n%=k}h[e]=o[Math.floor(n)]}this.phase=n};TableLookupOscillator.prototype.toString=function(){return"Table Lookup Oscillator"};
/*!
 * @depends TableLookupOscillator.js
 */
var Sine=function(a,b){TableLookupOscillator.call(this,a,Sine.TABLE,b)};extend(Sine,TableLookupOscillator);Sine.prototype.toString=function(){return"Sine"};Sine.TABLE=[];for(var i=0;i<8192;i++){Sine.TABLE.push(Math.sin(i*2*Math.PI/8192))}
/*!
 * @depends ../core/AudioletNode.js
 * @depends Sine.js
 */
var CrossFade=function(b,a){AudioletNode.call(this,b,3,1);this.linkNumberOfOutputChannels(0,0);this.position=new AudioletParameter(this,2,a||0.5)};extend(CrossFade,AudioletNode);CrossFade.prototype.generate=function(f,r){var n=f[0];var m=f[1];var y=r[0];var c=n.channels;var b=m.channels;var s=y.channels;if(n.isEmpty&&m.isEmpty){y.isEmpty=true;return}var v=this.position;var z,w;if(v.isStatic()){z=v.getValue()}else{w=v.getChannel()}var q=y.length;for(var x=0;x<q;x++){if(w){z=w[x]}var a=Sine.TABLE.length/4;var k=Math.floor(z*a);var g=Sine.TABLE[k+a];var d=Sine.TABLE[k];var l=n.numberOfChannels;for(var u=0;u<l;u++){var p=c[u];var o=b[u];var t=s[u];var h,e;if(!n.isEmpty){h=p[x]}else{h=0}if(!m.isEmpty){e=o[x]}else{e=0}t[x]=h*g+e*d}}};CrossFade.prototype.toString=function(){return"Cross Fader"};
/*!
 * @depends ../core/AudioletNode.js
 */
var DampedCombFilter=function(b,e,d,c,a){AudioletNode.call(this,b,4,1);this.linkNumberOfOutputChannels(0,0);this.maximumDelayTime=e;this.delayTime=new AudioletParameter(this,1,d||1);this.decayTime=new AudioletParameter(this,2,c);this.damping=new AudioletParameter(this,3,a);var f=e*this.audiolet.device.sampleRate;this.buffers=[];this.readWriteIndex=0;this.filterStore=0};extend(DampedCombFilter,AudioletNode);DampedCombFilter.prototype.generate=function(d,r){var v=d[0];var B=r[0];if(v.isEmpty){B.isEmpty=true;return}var z=this.maximumDelayTime;var c=this.audiolet.device.sampleRate;var F=this.delayTime;var a,A;if(F.isStatic()){a=Math.floor(F.getValue()*c)}else{A=F.getChannel()}var b=this.decayTime;var e,o;if(b.isStatic()){e=Math.floor(b.getValue()*c)}else{o=b.getChannel()}var p=this.damping;var f,G;if(p.isStatic()){f=p.getValue()}else{G=p.getChannel()}var g;if(F.isStatic()&&b.isStatic()){g=Math.exp(-3*a/e)}var E=this.buffers;var D=this.readWriteIndex;var t=this.filterStore;var k=v.channels;var s=B.channels;var h=v.numberOfChannels;var C=E.length;for(var y=C;y<h;y++){var m=z*c;E.push(new Float32Array(m))}var n=v.length;for(var y=0;y<n;y++){if(A){a=Math.floor(A[y]*c)}if(o){e=Math.floor(o[y]*c)}if(G){f=G[y]}if(A||o){g=Math.exp(-3*a/e)}for(var x=0;x<h;x++){var l=k[x];var u=s[x];var w=E[x];var q=w[D];t=(q*(1-f))+(t*f);u[y]=q;w[D]=l[y]+g*t}D+=1;if(D>=a){D=0}}this.readWriteIndex=D;this.filterStore=t};DampedCombFilter.prototype.toString=function(){return"Damped Comb Filter"};
/*!
 * @depends ../core/AudioletNode.js
 */
var DCFilter=function(b,a){AudioletNode.call(this,b,2,1);this.linkNumberOfOutputChannels(0,0);this.coefficient=new AudioletParameter(this,1,a||0.995);this.xValues=[];this.yValues=[]};extend(DCFilter,AudioletNode);DCFilter.prototype.generate=function(b,m){var p=b[0];var u=m[0];if(p.isEmpty){u.isEmpty=true;return}var s=this.xValues;var e=this.yValues;var a=this.coefficient;var l,n;if(a.isStatic()){l=a.getValue()}else{n=a.getChannel()}var d=p.channels.length;var g=u.length;for(var r=0;r<d;r++){var f=p.channels[r];var o=u.channels[r];if(r>=s.length){s.push(0)}if(r>=e.length){e.push(0)}var k=s[r];var h=e[r];for(var q=0;q<g;q++){if(n){var l=n[q]}var t=f[q];var c=t-k+l*h;o[q]=c;k=t;h=c}s[r]=k;e[r]=h}};DCFilter.prototype.toString=function(){return"DC Filter"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Delay=function(a,c,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.maximumDelayTime=c;this.delayTime=new AudioletParameter(this,1,b||1);var d=c*this.audiolet.device.sampleRate;this.buffers=[];this.readWriteIndex=0};extend(Delay,AudioletNode);Delay.prototype.generate=function(c,k){var n=c[0];var t=k[0];var r=this.maximumDelayTime;var b=this.audiolet.device.sampleRate;var w=this.delayTime;var a,s;if(w.isStatic()){a=Math.floor(w.getValue()*b)}else{s=w.getChannel()}var u=this.buffers;var v=this.readWriteIndex;var d=[];var l=[];var e=n.numberOfChannels;for(var q=0;q<e;q++){d.push(n.getChannelData(q));l.push(t.getChannelData(q));if(q>=u.length){var g=r*b;u.push(new Float32Array(g))}}var h=n.length;for(var q=0;q<h;q++){if(s){a=Math.floor(s[q]*b)}for(var p=0;p<e;p++){var f=d[p];var m=l[p];var o=u[p];m[q]=o[v];if(!n.isEmpty){o[v]=f[q]}else{o[v]=0}}v+=1;if(v>=a){v=0}}this.readWriteIndex=v};Delay.prototype.toString=function(){return"Delay"};
/*!
 * @depends ../core/AudioletNode.js
 */
var DiscontinuityDetector=function(b,a,c){AudioletNode.call(this,b,1,1);this.linkNumberOfOutputChannels(0,0);this.threshold=a||0.2;if(c){this.callback=c}this.lastValues=[]};extend(DiscontinuityDetector,AudioletNode);DiscontinuityDetector.prototype.callback=function(b,c,a){console.error("Discontinuity of "+b+" detected on channel "+c+" index "+a)};DiscontinuityDetector.prototype.generate=function(d,l){var g=d[0];if(g.isEmpty){this.lastValues=[];return}var f=this.lastValues;var e=this.threshold;var m=g.numberOfChannels;for(var c=0;c<m;c++){var h=g.getChannelData(c);if(c>=f.length){f.push(null)}var k=f[c];var a=g.length;for(var b=0;b<a;b++){var n=h[b];if(k!=null){if(Math.abs(k-n)>e){this.callback(Math.abs(k-n),c,b)}}k=n}f[c]=k}};DiscontinuityDetector.prototype.toString=function(){return"Discontinuity Detector"};
/*!
 * @depends ../core/AudioletNode.js
 */
var FeedbackDelay=function(b,e,d,a,c){AudioletNode.call(this,b,4,1);this.linkNumberOfOutputChannels(0,0);this.maximumDelayTime=e;this.delayTime=new AudioletParameter(this,1,d||1);this.feedback=new AudioletParameter(this,2,a||0.5);this.mix=new AudioletParameter(this,3,c||1);var f=e*this.audiolet.device.sampleRate;this.buffers=[];this.readWriteIndex=0};extend(FeedbackDelay,AudioletNode);FeedbackDelay.prototype.generate=function(d,o){var v=d[0];var B=o[0];var z=this.maximumDelayTime;var c=this.audiolet.device.sampleRate;var F=this.delayTime;var b,A;if(F.isStatic()){b=Math.floor(F.getValue()*c)}else{A=F.getChannel()}var a=this.feedback;var e,s;if(a.isStatic()){e=a.getValue()}else{s=a.getChannel()}var m=this.mix;var q,u;if(m.isStatic()){q=m.getValue()}else{u=m.getChannel()}var D=this.buffers;var E=this.readWriteIndex;var g=v.channels;var r=B.channels;var f=v.numberOfChannels;var C=D.length;for(var y=C;y<f;y++){var k=z*c;D.push(new Float32Array(k))}var l=v.length;for(var y=0;y<l;y++){if(A){b=Math.floor(A[y]*c)}if(s){e=s[y]}if(u){q=u[y]}for(var x=0;x<f;x++){var h=g[x];var t=r[x];var w=D[x];var p;if(!v.isEmpty){p=h[y]}else{p=0}var n=w[E];t[y]=q*n+(1-q)*p;w[E]=p+e*n}E+=1;if(E>=b){E=0}}this.readWriteIndex=E};FeedbackDelay.prototype.toString=function(){return"Feedback Delay"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Gain=function(a,b){AudioletNode.call(this,a,2,1);this.linkNumberOfOutputChannels(0,0);this.gain=new AudioletParameter(this,1,b||1)};extend(Gain,AudioletNode);Gain.prototype.generate=function(h,m){var k=h[0];var c=m[0];if(k.isEmpty){c.isEmpty=true;return}var d=this.gain;var o,l;if(d.isStatic()){o=d.getValue()}else{l=d.getChannel()}var n=k.numberOfChannels;for(var g=0;g<n;g++){var b=k.getChannelData(g);var f=c.getChannelData(g);var a=k.length;for(var e=0;e<a;e++){if(l){o=l[e]}f[e]=b[e]*o}}};Gain.prototype.toString=function(){return("Gain")};
/*!
 * @depends BiquadFilter.js
 */
var HighPassFilter=function(a,b){BiquadFilter.call(this,a,b)};extend(HighPassFilter,BiquadFilter);HighPassFilter.prototype.calculateCoefficients=function(e){var b=2*Math.PI*e/this.audiolet.device.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=(1+a)/2;this.b1=-(1+a);this.b2=this.b0;this.a0=1+d;this.a1=-2*a;this.a2=1-d};HighPassFilter.prototype.toString=function(){return"High Pass Filter"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Lag=function(a,c,b){AudioletNode.call(this,a,2,1);this.value=new AudioletParameter(this,0,c||0);this.lag=new AudioletParameter(this,1,b||1);this.lastValue=c||0;this.log001=Math.log(0.001)};extend(Lag,AudioletNode);Lag.prototype.generate=function(l,p){var d=p[0];var j=d.getChannelData(0);var r=this.audiolet.device.sampleRate;var f=this.log001;var n=this.value;var q,b;if(n.isStatic()){q=n.getValue()}else{b=n.getChannel()}var m=this.lag;var g,c,h;if(m.isStatic()){g=m.getValue();h=Math.exp(f/(g*r))}else{c=m.getChannel()}var o=this.lastValue;var a=d.length;for(var k=0;k<a;k++){if(b){q=b[k];h=Math.exp(f/(g*r))}if(c){g=c[k]}var e=((1-h)*q)+(h*o);j[k]=e;o=e}this.lastValue=o};Lag.prototype.toString=function(){return"Lag"};
/*!
 * @depends ../core/AudioletGroup.js
 */
var Limiter=function(c,b,d,a){AudioletNode.call(this,c,4,1);this.linkNumberOfOutputChannels(0,0);this.threshold=new AudioletParameter(this,1,b||0.95);this.attack=new AudioletParameter(this,2,d||0.01);this.release=new AudioletParameter(this,2,a||0.4);this.followers=[]};extend(Limiter,AudioletNode);Limiter.prototype.generate=function(b,m){var t=b[0];var A=m[0];if(t.isEmpty){A.isEmpty=true;return}var e=this.followers;var g=e.length;var a=this.audiolet.device.sampleRate;var B=this.attack;var w,q;if(B.isStatic()){w=Math.pow(0.01,1/(B.getValue()*a))}else{q=B.getChannel()}var x=this.release;var y,r;if(x.isStatic()){y=Math.pow(0.01,1/(x.getValue()*a))}else{r=x.getChannel()}var z=this.threshold;var f,l;if(z.isStatic()){f=z.getValue()}else{l=z.getChannel()}var d=t.numberOfChannels;for(var v=0;v<d;v++){if(v>=g){e.push(0)}var n=e[v];var h=t.getChannelData(v);var p=A.getChannelData(v);var k=t.length;for(var u=0;u<k;u++){var s=h[u];if(q){w=Math.pow(0.01,1/(q[u]*a))}if(r){y=Math.pow(0.01,1/(r[u]*a))}if(l){f=l[u]}var c=Math.abs(s);if(c>n){n=w*(n-c)+c}else{n=y*(n-c)+c}var o=n-f;if(o>0){p[u]=s/(1+o)}else{p[u]=s}}e[v]=n}};Limiter.prototype.toString=function(){return"Limiter"};
/*!
 * @depends ../core/AudioletNode.js
 */
var LinearCrossFade=function(b,a){AudioletNode.call(this,b,3,1);this.linkNumberOfOutputChannels(0,0);this.position=new AudioletParameter(this,2,a||0.5)};extend(LinearCrossFade,AudioletNode);LinearCrossFade.prototype.generate=function(d,n){var h=d[0];var g=d[1];var u=n[0];var b=h.channels;var a=g.channels;var o=u.channels;if(h.isEmpty||g.isEmpty){u.isEmpty=true;return}var q=this.position;var v,s;if(q.isStatic()){v=q.getValue()}else{s=q.getChannel()}var m=u.length;for(var t=0;t<m;t++){if(s){v=s[t]}var e=1-v;var c=v;var f=h.numberOfChannels;for(var r=0;r<f;r++){var l=b[r];var k=a[r];var p=o[r];p[t]=l[t]*e+k[t]*c}}};LinearCrossFade.prototype.toString=function(){return"Linear Cross Fader"};
/*!
 * @depends BiquadFilter.js
 */
var LowPassFilter=function(a,b){BiquadFilter.call(this,a,b)};extend(LowPassFilter,BiquadFilter);LowPassFilter.prototype.calculateCoefficients=function(e){var b=2*Math.PI*e/this.audiolet.device.sampleRate;var a=Math.cos(b);var c=Math.sin(b);var d=c/(2/Math.sqrt(2));this.b0=(1-a)/2;this.b1=1-a;this.b2=this.b0;this.a0=1+d;this.a1=-2*a;this.a2=1-d};LowPassFilter.prototype.toString=function(){return"Low Pass Filter"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Pan=function(a,b){AudioletNode.call(this,a,2,1);this.setNumberOfOutputChannels(0,2);if(b==null){var b=0.5}this.pan=new AudioletParameter(this,1,b)};extend(Pan,AudioletNode);Pan.prototype.generate=function(j,l){var k=j[0];var e=l[0];if(k.isEmpty){e.isEmpty=true;return}var b=k.getChannelData(0);var f=e.getChannelData(0);var d=e.getChannelData(1);var c=this.pan;var o,h;if(c.isStatic()){o=c.getValue()}else{h=c.getChannel()}var a=e.length;for(var g=0;g<a;g++){if(h){o=h[g]}var n=o*Math.PI/2;var m=b[g];f[g]=m*Math.cos(n);d[g]=m*Math.sin(n)}};Pan.prototype.toString=function(){return"Stereo Panner"};
/*!
 * @depends Envelope.js
 */
var PercussiveEnvelope=function(b,c,g,a,e){var d=[0,1,0];var f=[g,a];Envelope.call(this,b,c,d,f,null,e)};extend(PercussiveEnvelope,Envelope);PercussiveEnvelope.prototype.toString=function(){return"Percussive Envelope"};
/*!
 * @depends ../core/AudioletNode.js
 */
var Pulse=function(a,b,c){AudioletNode.call(this,a,2,1);this.frequency=new AudioletParameter(this,0,b||440);this.pulseWidth=new AudioletParameter(this,1,c||0.5);this.phase=0};extend(Pulse,AudioletNode);Pulse.prototype.generate=function(g,l){var d=l[0];var h=d.getChannelData(0);var m=this.audiolet.device.sampleRate;var n=this.phase;var j=this.frequency;var k,c;if(j.isStatic()){k=j.getValue()}else{c=j.getChannel()}var b=this.pulseWidth;var f,o;if(b.isStatic()){f=b.getValue()}else{o=b.getChannel()}var a=d.length;for(var e=0;e<a;e++){if(c){k=c[e]}if(o){f=o[e]}n+=k/m;if(n>1){n%=1}h[e]=(n<f)?1:-1}this.phase=n};Pulse.prototype.toString=function(){return"Pulse"};
/*!
 * @depends ../core/AudioletNode.js
 * @depends ../core/AudioletGroup.js
 */
var ReverbB=function(c,f,a,b){AudioletGroup.call(this,c,4,1);this.initialMix=0.33;this.fixedGain=0.015;this.initialDamping=0.5;this.scaleDamping=0.4;this.initialRoomSize=0.5;this.scaleRoom=0.28;this.offsetRoom=0.7;this.combTuning=[1116,1188,1277,1356,1422,1491,1557,1617];this.allPassTuning=[556,441,341,225];var a=a||this.initialRoomSize;this.roomSizeNode=new ParameterNode(c,a);this.roomSizeMulAdd=new MulAdd(c,this.scaleRoom,this.offsetRoom);var b=b||this.initialDamping;this.dampingNode=new ParameterNode(c,b);this.dampingMulAdd=new MulAdd(c,this.scaleDamping);this.roomSize=this.roomSizeNode.parameter;this.damping=this.dampingNode.parameter;this.gain=new Gain(c,this.fixedGain);this.combFilters=[];this.fgConverters=[];for(var e=0;e<this.combTuning.length;e++){var h=this.combTuning[e]/this.audiolet.device.sampleRate;this.combFilters[e]=new DampedCombFilter(c,h,h);this.fgConverters[e]=new FeedbackGainToDecayTime(c,h)}this.allPassFilters=[];for(var e=0;e<this.allPassTuning.length;e++){this.allPassFilters[e]=new AllPassFilter(c,this.allPassTuning[e])}var f=f||this.initialMix;this.mixer=new LinearCrossFade(c,f);this.mix=this.mixer.position;this.inputs[1].connect(this.mixer,0,2);this.inputs[2].connect(this.roomSizeNode);this.roomSizeNode.connect(this.roomSizeMulAdd);this.inputs[3].connect(this.dampingNode);this.dampingNode.connect(this.dampingMulAdd);this.inputs[0].connect(this.gain);for(var e=0;e<this.combFilters.length;e++){this.gain.connect(this.combFilters[e]);this.combFilters[e].connect(this.allPassFilters[0]);this.roomSizeMulAdd.connect(this.fgConverters[e]);this.fgConverters[e].connect(this.combFilters[e],0,2);this.dampingMulAdd.connect(this.combFilters[e],0,3)}var d=this.allPassFilters.length;for(var e=0;e<d-1;e++){this.allPassFilters[e].connect(this.allPassFilters[e+1])}this.inputs[0].connect(this.mixer);var g=d-1;this.allPassFilters[g].connect(this.mixer,0,1);this.mixer.connect(this.outputs[0])};extend(ReverbB,AudioletGroup);ReverbB.prototype.toString=function(){return"Reverb B"};var FeedbackGainToDecayTime=function(a,b){AudioletNode.call(this,a,1,1);this.delayTime=b;this.lastFeedbackGain=null;this.decayTime=null};extend(FeedbackGainToDecayTime,AudioletNode);FeedbackGainToDecayTime.prototype.generate=function(h,k){var j=h[0];var d=k[0];var c=j.channels[0];var e=d.channels[0];var g=this.lastDelayTime;var l=this.decayTime;var m=this.lastFeedbackGain;var b=d.length;for(var f=0;f<b;f++){var a=c[f];if(a!=m){l=-3*g/Math.log(a);m=a}e[f]=a}this.decayTime=l;this.lastFeedbackGain=m};
/*!
 * @depends ../core/AudioletNode.js
 * @depends ../core/AudioletGroup.js
 */
var Reverb=function(d,g,a,c){AudioletNode.call(this,d,4,1);this.initialMix=0.33;this.fixedGain=0.015;this.initialDamping=0.5;this.scaleDamping=0.4;this.initialRoomSize=0.5;this.scaleRoom=0.28;this.offsetRoom=0.7;this.combTuning=[1116,1188,1277,1356,1422,1491,1557,1617];this.allPassTuning=[556,441,341,225];var g=g||this.initialMix;this.mix=new AudioletParameter(this,1,g);var a=a||this.initialRoomSize;this.roomSize=new AudioletParameter(this,2,a);var c=c||this.initialDamping;this.damping=new AudioletParameter(this,3,c);this.combBuffers=[];this.combIndices=[];this.filterStores=[];var b=this.combTuning.length;for(var f=0;f<b;f++){this.combBuffers.push(new Float32Array(this.combTuning[f]));this.combIndices.push(0);this.filterStores.push(0)}this.allPassBuffers=[];this.allPassIndices=[];var e=this.allPassTuning.length;for(var f=0;f<e;f++){this.allPassBuffers.push(new Float32Array(this.allPassTuning[f]));this.allPassIndices.push(0)}};extend(Reverb,AudioletNode);Reverb.prototype.generate=function(k,d){var K=k[0];var q=K.channels[0];var b=d[0];var l=b.channels[0];var z=this.mix;var L,p;if(z.isStatic()){L=z.getValue()}else{p=z.getChannel()}var Q=this.roomSize;var F,G;if(Q.isStatic()){F=Q.getValue()}else{G=Q.getChannel()}var u=this.damping;var o,P;if(u.isStatic()){o=u.getValue()}else{P=u.getChannel()}var m=this.combTuning.length;var A=this.allPassTuning.length;var E=this.fixedGain;var J=this.combBuffers;var r=this.combIndices;var f=this.filterStores;var g=this.allPassBuffers;var H=this.allPassIndices;var s=this.scaleDamping;var w=this.scaleRoom;var D=this.offsetRoom;var C=K.length;for(var O=0;O<C;O++){if(p){L=p[O]}if(G){F=G[O]}if(P){o=P[O]}var I;if(!K.isEmpty){I=q[O]}else{I=0}var c=I;I*=E;var M=I;var o=o*s;var x=F*w+D;for(var N=0;N<m;N++){var e=r[N];var B=J[N];var n=f[N];var v=B[e];n=(v*(1-o))+(n*o);I+=v;B[e]=M+x*n;e+=1;if(e>=B.length){e=0}r[N]=e;f[N]=n}for(var N=0;N<A;N++){var t=g[N];var y=H[N];var a=I;var h=t[y];I=-I+h;t[y]=a+(h*0.5);y+=1;if(y>=t.length){y=0}H[N]=y}l[O]=L*I+(1-L)*c}};Reverb.prototype.toString=function(){return"Reverb"};
/*!
 * @depends TableLookupOscillator.js
 */
var Saw=function(a,b){TableLookupOscillator.call(this,a,Saw.TABLE,b)};extend(Saw,TableLookupOscillator);Saw.prototype.toString=function(){return"Saw"};Saw.TABLE=[];for(var i=0;i<8192;i++){Saw.TABLE.push(((((i-4096)/8192)%1)+1)%1*2-1)}
/*!
 * @depends ../core/AudioletNode.js
 */
var SoftClip=function(a){AudioletNode.call(this,a,1,1);this.linkNumberOfOutputChannels(0,0)};extend(SoftClip,AudioletNode);SoftClip.prototype.generate=function(g,k){var h=g[0];var c=k[0];if(h.isEmpty){c.isEmpty=true;return}var l=h.numberOfChannels;for(var f=0;f<l;f++){var b=h.getChannelData(f);var e=c.getChannelData(f);var a=h.length;for(var d=0;d<a;d++){var m=b[d];if(m>0.5){e[d]=(m-0.25)/m}else{if(m<-0.5){e[d]=(-m-0.25)/m}else{e[d]=m}}}}};SoftClip.prototype.toString=function(){return("SoftClip")};
/*!
 * @depends TableLookupOscillator.js
 */
var Square=function(a,b){TableLookupOscillator.call(this,a,Square.TABLE,b)};extend(Square,TableLookupOscillator);Square.prototype.toString=function(){return"Square"};Square.TABLE=[];for(var i=0;i<8192;i++){Square.TABLE.push(((i-4096)/8192)<0?1:-1)}
/*!
 * @depends TableLookupOscillator.js
 */
var Triangle=function(a,b){TableLookupOscillator.call(this,a,Triangle.TABLE,b)};extend(Triangle,TableLookupOscillator);Triangle.prototype.toString=function(){return"Triangle"};Triangle.TABLE=[];for(var i=0;i<8192;i++){Triangle.TABLE.push(Math.abs(((((i-2048)/8192)%1)+1)%1*2-1)*2-1)}
/*!
 * @depends ../core/AudioletNode.js
 */
var TriggerControl=function(b,a){AudioletNode.call(this,b,0,1);this.trigger=new AudioletParameter(this,null,a||0)};extend(TriggerControl,AudioletNode);TriggerControl.prototype.generate=function(f,h){var a=h[0];var g=a.getChannelData(0);var b=this.trigger;var c=b.getValue();var e=a.length;for(var d=0;d<e;d++){if(c){g[d]=1;b.setValue(0);c=0}else{g[d]=0}}};TriggerControl.prototype.toString=function(){return"Trigger Control"};
/*!
 * @depends ../core/AudioletNode.js
 */
var UpMixer=function(a,b){AudioletNode.call(this,a,1,1);this.outputChannels=b;this.outputs[0].numberOfChannels=b};extend(UpMixer,AudioletNode);UpMixer.prototype.generate=function(e,h){var f=e[0];var b=h[0];if(f.isEmpty){b.isEmpty=true;return}var g=this.outputChannels;var j=f.numberOfChannels;for(var d=0;d<g;d++){var a=f.getChannelData(d%j);var c=b.getChannelData(d);c.set(a)}};UpMixer.prototype.toString=function(){return"UpMixer"};var WebKitBufferPlayer=function(b,a){AudioletNode.call(this,b,0,1);this.isWebKit=this.audiolet.device.sink instanceof Sink.sinks.webkit;this.context=this.audiolet.device.sink._context;if(this.isWebKit){this.xhr=new XMLHttpRequest();this.xhr.open("GET",a,true);this.xhr.responseType="arraybuffer";this.xhr.onload=this.onLoad.bind(this);this.xhr.send()}this.ready=false};extend(WebKitBufferPlayer,AudioletNode);WebKitBufferPlayer.prototype.onLoad=function(){this.fileBuffer=this.context.createBuffer(this.xhr.response,false);this.setNumberOfOutputChannels(0,this.fileBuffer.numberOfChannels);this.jsNode=this.context.createJavaScriptNode(4096,this.fileBuffer.numberOfChannels,0);this.jsNode.onaudioprocess=this.onData.bind(this);this.source=this.context.createBufferSource();this.source.buffer=this.fileBuffer;this.source.connect(this.jsNode);this.jsNode.connect(this.context.destination);this.source.noteOn(0);this.buffer=new AudioletBuffer(this.fileBuffer.numberOfChannels,1024);this.ready=true};WebKitBufferPlayer.prototype.onData=function(g){var e=this.buffer.length;var h=e+g.inputBuffer.length;this.buffer.resize(this.buffer.numberOfChannels,h);for(var b=0;b<g.inputBuffer.numberOfChannels;b++){var f=g.inputBuffer.getChannelData(b);var d=this.buffer.getChannelData(b);var c=g.inputBuffer.length;for(var a=0;a<g.inputBuffer.length;a++){d[e+a]=f[a]}}};WebKitBufferPlayer.prototype.generate=function(b,c){var a=c[0];if(!this.ready){a.isEmpty=true;return}if(this.buffer.length>a.length){this.buffer.shift(a)}else{a.isEmpty=true}};
/*!
 * @depends ../core/AudioletNode.js
 */
var WhiteNoise=function(a){AudioletNode.call(this,a,0,1)};extend(WhiteNoise,AudioletNode);WhiteNoise.prototype.generate=function(d,f){var a=f[0];var e=a.getChannelData(0);var c=a.length;for(var b=0;b<c;b++){e[b]=Math.random()*2-1}};WhiteNoise.prototype.toString=function(){return"White Noise"};var Pattern=function(){};Pattern.prototype.next=function(){return null};Pattern.prototype.valueOf=function(a){if(a instanceof Pattern){return(a.next())}else{return(a)}};Pattern.prototype.reset=function(){};
/*!
 * @depends Pattern.js
 */
var PArithmetic=function(c,b,a){Pattern.call(this);this.start=c;this.value=c;this.step=b;this.repeats=a;this.position=0};extend(PArithmetic,Pattern);PArithmetic.prototype.next=function(){var a;if(this.position==0){a=this.value;this.position+=1}else{if(this.position<this.repeats){var b=this.valueOf(this.step);if(b!=null){this.value+=b;a=this.value;this.position+=1}else{a=null}}else{a=null}}return(a)};PArithmetic.prototype.reset=function(){this.value=this.start;this.position=0;if(this.step instanceof Pattern){this.step.reset()}};var Pseries=PArithmetic;
/*!
 * @depends Pattern.js
 */
var PChoose=function(b,a){Pattern.call(this);this.list=b;this.repeats=a||1;this.position=0};extend(PChoose,Pattern);PChoose.prototype.next=function(){var b;if(this.position<this.repeats){var a=Math.floor(Math.random()*this.list.length);var c=this.list[a];var d=this.valueOf(c);if(d!=null){if(!(c instanceof Pattern)){this.position+=1}b=d}else{if(c instanceof Pattern){c.reset()}this.position+=1;b=this.next()}}else{b=null}return(b)};PChoose.prototype.reset=function(){this.position=0;for(var a=0;a<this.list.length;a++){var b=this.list[a];if(b instanceof Pattern){b.reset()}}};var Prand=PChoose;
/*!
 * @depends Pattern.js
 */
var PGeometric=function(c,b,a){Pattern.call(this);this.start=c;this.value=c;this.step=b;this.repeats=a;this.position=0};extend(PGeometric,Pattern);PGeometric.prototype.next=function(){var a;if(this.position==0){a=this.value;this.position+=1}else{if(this.position<this.repeats){var b=this.valueOf(this.step);if(b!=null){this.value*=b;a=this.value;this.position+=1}else{a=null}}else{a=null}}return(a)};PGeometric.prototype.reset=function(){this.value=this.start;this.position=0;if(this.step instanceof Pattern){this.step.reset()}};var Pgeom=PGeometric;
/*!
 * @depends Pattern.js
 */
var PProxy=function(a){Pattern.call(this);if(a){this.pattern=a}};extend(PProxy,Pattern);PProxy.prototype.next=function(){var a;if(this.pattern){var a=this.pattern.next()}else{a=null}return a};var Pp=PProxy;
/*!
 * @depends Pattern.js
 */
var PRandom=function(a,c,b){Pattern.call(this);this.low=a;this.high=c;this.repeats=b;this.position=0};extend(PRandom,Pattern);PRandom.prototype.next=function(){var b;if(this.position<this.repeats){var a=this.valueOf(this.low);var c=this.valueOf(this.high);if(a!=null&&c!=null){b=a+Math.random()*(c-a);this.position+=1}else{b=null}}else{b=null}return(b)};PRandom.prototype.reset=function(){this.position=0};var Pwhite=PRandom;
/*!
 * @depends Pattern.js
 */
var PSequence=function(b,a,c){Pattern.call(this);this.list=b;this.repeats=a||1;this.position=0;this.offset=c||0};extend(PSequence,Pattern);PSequence.prototype.next=function(){var b;if(this.position<this.repeats*this.list.length){var a=(this.position+this.offset)%this.list.length;var c=this.list[a];var d=this.valueOf(c);if(d!=null){if(!(c instanceof Pattern)){this.position+=1}b=d}else{if(c instanceof Pattern){c.reset()}this.position+=1;b=this.next()}}else{b=null}return(b)};PSequence.prototype.reset=function(){this.position=0;for(var a=0;a<this.list.length;a++){var b=this.list[a];if(b instanceof Pattern){b.reset()}}};var Pseq=PSequence;
/*!
 * @depends Pattern.js
 */
var PSeries=function(b,a,c){Pattern.call(this);this.list=b;this.repeats=a||1;this.position=0;this.offset=c||0};extend(PSeries,Pattern);PSeries.prototype.next=function(){var b;if(this.position<this.repeats){var a=(this.position+this.offset)%this.list.length;var c=this.list[a];var d=this.valueOf(c);if(d!=null){if(!(c instanceof Pattern)){this.position+=1}b=d}else{if(c instanceof Pattern){c.reset()}this.position+=1;b=this.next()}}else{b=null}return(b)};PSeries.prototype.reset=function(){this.position=0;for(var a=0;a<this.list.length;a++){var b=this.list[a];if(b instanceof Pattern){b.reset()}}};var Pser=PSeries;
/*!
 * @depends Pattern.js
 */
var PShuffle=function(d,a){Pattern.call(this);this.list=[];while(d.length){var b=Math.floor(Math.random()*d.length);var c=d.splice(b,1);this.list.push(c)}this.repeats=a;this.position=0};extend(PShuffle,Pattern);PShuffle.prototype.next=function(){var b;if(this.position<this.repeats*this.list.length){var a=(this.position+this.offset)%this.list.length;var c=this.list[a];var d=this.valueOf(c);if(d!=null){if(!(c instanceof Pattern)){this.position+=1}b=d}else{if(c instanceof Pattern){c.reset()}this.position+=1;b=this.next()}}else{b=null}return(b)};var Pshuffle=PShuffle;var Scale=function(b,a){this.degrees=b;this.tuning=a||new EqualTemperamentTuning(12)};Scale.prototype.getFrequency=function(d,a,b){var c=a;b+=Math.floor(d/this.degrees.length);d%=this.degrees.length;c*=Math.pow(this.tuning.octaveRatio,b);c*=this.tuning.ratios[this.degrees[d]];return c};
/*!
 * @depends Scale.js
 */
var MajorScale=function(){Scale.call(this,[0,2,4,5,7,9,11])};extend(MajorScale,Scale);
/*!
 * @depends Scale.js
 */
var MinorScale=function(){Scale.call(this,[0,2,3,5,7,8,10])};extend(MinorScale,Scale);var Tuning=function(d,c){this.semitones=d;this.octaveRatio=c||2;this.ratios=[];var b=this.semitones.length;for(var a=0;a<b;a++){this.ratios.push(Math.pow(2,this.semitones[a]/b))}};
/*!
 * @depends Tuning.js
 */
var EqualTemperamentTuning=function(b){var c=[];for(var a=0;a<b;a++){c.push(a)}Tuning.call(this,c,2)};extend(EqualTemperamentTuning,Tuning);(function(g){function e(n,m,p,l){var j=e.sinks,k;for(k in j){if(j.hasOwnProperty(k)&&j[k].enabled){try{return new j[k](n,m,p,l)}catch(o){}}}throw e.Error(2)}function f(){var j;for(j in f.prototype){if(f.prototype.hasOwnProperty(j)){this[j]=f.prototype[j]}}this._listeners={}}f.prototype={_listeners:null,emit:function(k,j){if(this._listeners[k]){for(var l=0;l<this._listeners[k].length;l++){this._listeners[k][l].apply(this,j)}}return this},on:function(j,k){this._listeners[j]=this._listeners[j]||[];this._listeners[j].push(k);return this},off:function(j,l){if(this._listeners[j]){if(!l){delete this._listeners[j];return this}for(var k=0;k<this._listeners[j].length;k++){if(this._listeners[j][k]===l){this._listeners[j].splice(k--,1)}}this._listeners[j].length||delete this._listeners[j]}return this},};e.EventEmitter=f;function h(l){if(!h.hasOwnProperty(l)){throw h(1)}if(!(this instanceof h)){return new h(l)}var j;for(j in h[l]){if(h[l].hasOwnProperty(j)){this[j]=h[l][j]}}this.code=l}h.prototype=new Error();h.prototype.toString=function(){return"SinkError 0x"+this.code.toString(16)+": "+this.message};h[1]={message:"No such error code.",explanation:"The error code does not exist.",};h[2]={message:"No audio sink available.",explanation:"The audio device may be busy, or no supported output API is available for this browser.",};h[16]={message:"Buffer underflow.",explanation:"Trying to recover...",};h[17]={message:"Critical recovery fail.",explanation:"The buffer underflow has reached a critical point, trying to recover, but will probably fail anyway.",};h[18]={message:"Buffer size too large.",explanation:"Unable to allocate the buffer due to excessive length, please try a smaller buffer. Buffer size should probably be smaller than the sample rate.",};e.Error=h;function d(j){this.boundTo=j;this.buffers=[];j.activeRecordings.push(this)}d.prototype={add:function(j){this.buffers.push(j)},clear:function(){this.buffers=[]},stop:function(){var j=this.boundTo.activeRecordings,k;for(k=0;k<j.length;k++){if(j[k]===this){j.splice(k--,1)}}},join:function(){var p=0,q=0,m=this.buffers,j,r,o,k=m.length;for(o=0;o<k;o++){p+=m[o].length}j=new Float32Array(p);for(o=0;o<k;o++){for(r=0;r<m[o].length;r++){j[q+r]=m[o][r]}q+=m[o].length}return j}};function c(){}e.SinkClass=c;c.prototype={sampleRate:44100,channelCount:2,bufferSize:4096,writePosition:0,writeMode:"async",channelMode:"interleaved",previousHit:0,ringBuffer:null,ringOffset:0,start:function(l,k,m,j){this.channelCount=isNaN(k)||k===null?this.channelCount:k;this.bufferSize=isNaN(m)||m===null?this.bufferSize:m;this.sampleRate=isNaN(j)||j===null?this.sampleRate:j;this.readFn=l;this.activeRecordings=[];this.previousHit=+new Date;this.asyncBuffers=[];this.syncBuffers=[];e.EventEmitter.call(this)},process:function(l,m){this.ringBuffer&&(this.channelMode==="interleaved"?this.ringSpin:this.ringSpinInterleaved).apply(this,arguments);this.writeBuffersSync.apply(this,arguments);if(this.channelMode==="interleaved"){this.readFn&&this.readFn.apply(this,arguments);this.emit("audioprocess",arguments)}else{var j=e.deinterleave(l,this.channelCount),k=[j].concat([].slice.call(arguments,1));this.readFn&&this.readFn.apply(this,k);this.emit("audioprocess",k);e.interleave(j,this.channelCount,l)}this.writeBuffersAsync.apply(this,arguments);this.recordData.apply(this,arguments);this.previousHit=+new Date;this.writePosition+=l.length/m},record:function(){return new d(this)},recordData:function(k){var n=this.activeRecordings,m,j=n.length;for(m=0;m<j;m++){n[m].add(k)}},writeBuffersAsync:function(m){var k=this.asyncBuffers,j=m.length,o,q,p,s,r;if(k){for(p=0;p<k.length;p++){o=k[p];q=o.b.length;r=o.d;o.d-=Math.min(r,j);for(s=0;s+r<j&&s<q;s++){m[s+r]+=o.b[s]}o.b=o.b.subarray(s+r);p>=q&&k.splice(p--,1)}}},writeBuffersSync:function(m){var k=this.syncBuffers,j=m.length,n=0,o=0;for(;n<j&&k.length;n++){m[n]+=k[0][o];if(k[0].length<=o){k.splice(0,1);o=0;continue}o++}if(k.length){k[0]=k[0].subarray(o)}},writeBufferAsync:function(k,l){k=this.mode==="deinterleaved"?e.interleave(k,this.channelCount):k;var j=this.asyncBuffers;j.push({b:k,d:isNaN(l)?~~((+new Date-this.previousHit)/1000*this.sampleRate):l});return j.length},writeBufferSync:function(k){k=this.mode==="deinterleaved"?e.interleave(k,this.channelCount):k;var j=this.syncBuffers;j.push(k);return j.length},writeBuffer:function(){return this[this.writeMode==="async"?"writeBufferAsync":"writeBufferSync"].apply(this,arguments)},getSyncWriteOffset:function(){var j=this.syncBuffers,l=0,k;for(k=0;k<j.length;k++){l+=j[k].length}return l},getPlaybackTime:function(){return this.writePosition-this.bufferSize},ringSpin:function(n){var o=this.ringBuffer,k=n.length,j=o.length,q=this.ringOffset,p;for(p=0;p<k;p++){n[p]+=o[q];q=(q+1)%j}this.ringOffset=q},ringSpinDeinterleaved:function(s){var r=this.ringBuffer,q=s.length,j=r.length,p=r[0].length,u=j*p,o=this.ringOffset,t,k;for(t=0;t<q;t+=j){for(k=0;k<j;k++){s[t+k]+=r[k][o]}o=(o+1)%p}this.ringOffset=k}};function a(m,l,j,k){j=j||l.prototype;l.prototype=new e.SinkClass();l.prototype.type=m;l.enabled=!k;for(k in j){if(j.hasOwnProperty(k)){l.prototype[k]=j[k]}}a[m]=l}a("moz",function(){var t=this,l=0,r=null,q=new Audio(),p,o,m,n,s,j;t.start.apply(t,arguments);t.preBufferSize=isNaN(arguments[4])||arguments[4]===null?this.preBufferSize:arguments[4];function k(){if(r){p=q.mozWriteAudio(r);l+=p;if(p<r.length){r=r.subarray(p);return r}r=null}o=q.mozCurrentSampleOffset();m=Number(o+(s!==o?t.bufferSize:t.preBufferSize)*t.channelCount-l);o===s&&t.emit("error",[e.Error(16)]);if(m>0||s===o){try{n=new Float32Array(s===o?t.preBufferSize*t.channelCount:m)}catch(u){t.emit("error",[e.Error(18)]);t.kill();return}t.process(n,t.channelCount);p=t._audio.mozWriteAudio(n);if(p<n.length){r=n.subarray(p)}l+=p}s=o}q.mozSetup(t.channelCount,t.sampleRate);this._timers=[];this._timers.push(e.doInterval(function(){if(+new Date-t.previousHit>2000){t._audio=q=new Audio();q.mozSetup(t.channelCount,t.sampleRate);l=0;t.emit("error",[e.Error(17)])}},1000));this._timers.push(e.doInterval(k,20));t._bufferFill=k;t._audio=q},{bufferSize:24576,preBufferSize:24576,kill:function(){while(this._timers.length){this._timers[0]();this._timers.splice(0,1)}this.emit("kill")},getPlaybackTime:function(){return this._audio.mozCurrentSampleOffset()/this.channelCount}});var b=[];a("webkit",function(p,n,q,l){var j=this,m=new (window.AudioContext||webkitAudioContext)(),o=m.createJavaScriptNode(q,0,n);j.start.apply(j,arguments);function k(z){var r=z.outputBuffer,u=r.numberOfChannels,w,t,v=r.length,A=r.size,x=new Array(u),s=new Float32Array(v*u),y;for(w=0;w<u;w++){x[w]=r.getChannelData(w)}j.process(s,j.channelCount);for(w=0;w<v;w++){for(t=0;t<u;t++){x[t][w]=s[w*j.channelCount+t]}}}if(a.webkit.forceSampleRate&&j.sampleRate!==m.sampleRate){k=function k(z){var r=z.outputBuffer,u=r.numberOfChannels,w,t,v=r.length,A=r.size,x=new Array(u),s=new Float32Array(Math.floor(v*j.sampleRate/m.sampleRate)*u),y;for(w=0;w<u;w++){x[w]=r.getChannelData(w)}j.process(s,j.channelCount);s=e.deinterleave(s,j.channelCount);for(t=0;t<u;t++){y=e.resample(s[t],j.sampleRate,m.sampleRate);for(w=0;w<v;w++){x[t][w]=y[w]}}}}else{j.sampleRate=m.sampleRate}o.onaudioprocess=k;o.connect(m.destination);j._context=m;j._node=o;j._callback=k;b.push(o)},{kill:function(){this._node.disconnect(0);for(var j=0;j<b.length;j++){b[j]===this._node&&b.splice(j--,1)}this._node=this._context=null;this.kill();this.emit("kill")},getPlaybackTime:function(){return this._context.currentTime*this.sampleRate},});a.webkit.fix82795=b;a("dummy",function(){var j=this;j.start.apply(j,arguments);function k(){var l=new Float32Array(j.bufferSize*j.channelCount);j.process(l,j.channelCount)}j._kill=e.doInterval(k,j.bufferSize/j.sampleRate*1000);j._callback=k},{kill:function(){this._kill();this.emit("kill")},},true);e.sinks=e.devices=a;e.Recording=d;(function(){var l=typeof window==="undefined"?undefined:window.MozBlobBuilder||window.WebKitBlobBuilder||window.MSBlobBuilder||window.OBlobBuilder||window.BlobBuilder,k=typeof window==="undefined"?undefined:(window.MozURL||window.webkitURL||window.MSURL||window.OURL||window.URL);function j(m){var q=null,n,p;try{p=new l();p.append(m);n=k.createObjectURL(p.getBlob());q=new Worker(n);q._terminate=q.terminate;q._url=n;p=null;q.terminate=function(){this._terminate;k.revokeObjectURL(this._url)};j.type="blob";return q}catch(o){}try{q=new Worker("data:text/javascript;base64,"+btoa(m));j.type="data";return q}catch(o){}return q}j.ready=j.working=false;e.EventEmitter.call(j);j.test=function(){var o=j("this.onmessage=function(e){postMessage(e.data)}"),n="inlineWorker";j.ready=j.working=false;function m(p){if(j.ready){return}j.ready=true;j.working=p;j.emit("ready",[p]);j.off("ready")}if(!o){m(false)}else{o.onmessage=function(p){m(p.data===n)};o.postMessage(n);setTimeout(function(){m(false)},1000)}};e.inlineWorker=j;j.test()}());e.doInterval=function(n,l){var m,k;function j(o){if(e.inlineWorker.working&&!o){m=e.inlineWorker('setInterval(function(){ postMessage("tic"); }, '+l+");");m.onmessage=function(){n()};k=function(){m.terminate()}}else{m=setInterval(n,l);k=function(){clearInterval(m)}}}if(e.doInterval.backgroundWork||e.devices.moz.backgroundWork){e.inlineWorker.ready?j():e.inlineWorker.on("ready",function(){j()})}else{j(true)}return function(){if(!k){e.inlineWorker.ready||e.inlineWorker.on("ready",function(){k&&k()})}else{k()}}};e.doInterval.backgroundWork=true;(function(){function j(k,l){if(k&&l){j[k]=l}else{if(k&&j[k] instanceof Function){e.interpolate=j[k]}}return j[k]}e.interpolation=j;j("linear",function(k,o){var n=Math.floor(o),m=n+1,l=o-n;m=m<k.length?m:0;return k[n]*(1-l)+k[m]*l});j("nearest",function(k,l){return l>=k.length-0.5?k[0]:k[Math.round(l)]});j("linear")}());e.resample=function(s,j,v,w,m){var r=arguments.length,p=r===2?j:r===3?j/v:w/j*m/v,q=s.length,k=Math.ceil(q/p),u=new Float32Array(k),t,o;for(t=0,o=0;t<q;t+=p){u[o++]=e.interpolate(s,t)}return u};e.deinterleave=function(k,q){var j=k.length,p=j/q,m=[],o,r;for(o=0;o<q;o++){m[o]=new Float32Array(p);for(r=0;r<p;r++){m[o][r]=k[r*q+o]}}return m};e.interleave=function(m,q,k){q=q||m.length;var j=m[0].length,p=m.length,o,r;k=k||new Float32Array(j*q);for(o=0;o<p;o++){for(r=0;r<j;r++){k[o+r*q]=m[o][r]}}return k};e.mix=function(m){var k=[].slice.call(arguments,1),j,n,o;for(o=0;o<k.length;o++){j=Math.max(m.length,k[o].length);for(n=0;n<j;n++){m[n]+=k[o][n]}}return m};e.resetBuffer=function(k){var j=k.length,m;for(m=0;m<j;m++){k[m]=0}return k};e.clone=function(m,j){var k=m.length,n;j=j||new Float32Array(k);for(n=0;n<k;n++){j[n]=m[n]}return j};e.createDeinterleaved=function(m,l){var j=new Array(l),k;for(k=0;k<l;k++){j[k]=new Float32Array(m)}return j};g.Sink=e}(function(){return this}()));